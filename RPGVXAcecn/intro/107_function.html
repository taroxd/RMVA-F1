<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>関数</title>
<link href="../style.css" type="text/css" rel="stylesheet">
</head>
<body>

<h1>関数</h1>
<ul>
<li><a href="#call">関数の呼び出し</a></li>
<li><a href="#define">関数の定義</a></li>
<li><a href="#param">引数</a></li>
<li><a href="#default">デフォルト引数</a></li>
<li><a href="#redefine">関数の再定義</a></li>
</ul>

<p>数値の計算や文字列の表示など、一連の処理に名前を付けてひとつに
まとめたものを<strong>関数</strong>と呼びます。</p>


<h2><a name="call">関数の呼び出し</a></h2>
<p>関数という用語は数学にも出てきますが、プログラミングで使う関数は
どちらかというと「命令」に近いイメージで捉えたほうが良いでしょう。
今までに使ってきた p、print を「命令」と表現してきましたが、実は
これらも関数の一種です。</p>
<p>関数を自分で定義する方法を学ぶ前に、もっと関数らしい関数を使って
みましょう。乱数を生成する <strong>rand</strong> という関数がわかり
やすいでしょう。</p>
<pre>
p rand(100)
</pre>
<p>これは、実行するたびに違う数字 (0〜99) を表示するプログラムです。
rand 関数は、0 以上かつ指定された整数より少ない範囲の中からランダムに
数字を選んで返す関数です。
この「指定する値」のことを<strong>引数</strong> (ひきすう) と呼びます。
引数は通常、関数名の後のカッコ () 内で指定します (今までに出てきた print
などの呼び出しのように、意味が紛らわしくなければカッコを省略することも
可能です) 。上の例では 100 というのが rand 関数の引数です。
引数には、数値などを直接指定するだけではなく、
次の例のように任意の式を使用することができます。</p>
<pre>
x = 10
y = 20
p rand(x + y)       # p rand(30) と同じ
</pre>
<p>引数とは逆に、関数がその処理結果として呼び出し元に返してくる値のこと
を<strong>戻り値</strong>と呼びます。すなわち、rand 関数の戻り値は特定の
範囲のランダムな数値であるということです。関数の戻り値は、普通の値や変数
と同じように扱うことができます。</p>
<pre>
p rand(6) + 1
</pre>
<p>これは rand 関数の戻り値に 1 を加算し、その結果を表示するという意味
です。rand 関数に 6 を引数として渡した場合の戻り値は 0 から 5 の範囲の
乱数になりますから、それに 1 を足すということは、サイコロのように 1 から
6 までの範囲の値をランダムに表示するということになるわけです。</p>
<p>print や rand のような関数はあらかじめシステムに組み込まれている
ので、<strong>組み込み関数</strong>と呼ばれています。</p>


<h2><a name="define">関数の定義</a></h2>
<p>関数の定義は <strong>def</strong> で始まり <strong>end</strong> で
終わります。具体的には以下のような文法です。</p>
<pre>
def 関数の名前
  関数の内容
end
</pre>
<p>関数の名前の付け方は、基本的にローカル変数と同じと考えてください。
先頭に大文字を使用することもできますが、関数にそういった名前を付けることは
お勧めできません。なお、関数名の例外として、最後の文字には ? または ! と
いう記号を使用することができます。</p>
<p>たとえば、先ほどの rand(6) + 1 という処理を dice という名前の関数として
定義する場合、次のようになります。このように定義しておけば、これ以降 dice と
書いただけで 1 から 6 までの乱数を得ることができるようになるわけです。</p>
<pre>
def dice
  return rand(6) + 1
end

p dice              # p rand(6) + 1 と同じ
</pre>
<p>ここで return というのは、関数の処理を終了するための命令です。関数が
VX Ace のコモンイベントだとすると、return は [イベント処理の中断] に相当する
と考えてください。return の右側に書かれた式が、その関数の戻り値となります。
なお、関数を途中で中断する場合以外は return を省略することも可能です。</p>


<h2><a name="param">引数</a></h2>
<p>引数を取る関数は、以下のように定義します。</p>
<pre>
def abs(x)
  if x &lt; 0          # もし x が 0 未満であれば、
    return -x       #   関数を終了し、-x を戻り値とする。
  else              # それ以外であれば、
    return x        #   関数を終了し、x を戻り値とする。
  end               # 分岐終了。
end

p abs(-3)           # =&gt; 3
</pre>
<p>これは引数として与えられた値の絶対値を返す関数です。この「引数として
与えられた値」を仮に x として定義しています。
この x のことを<strong>仮引数</strong>と呼びます。関数内部では条件分岐を
使用し、x が 0 より少ない (マイナスの) ときには -x を、それ以外のとき
(0 以上のとき) には x を戻り値とします。最後の行では、-3 という引数を指定
して実際に abs 関数を呼び出し、その結果を p 関数で出力しています。x が仮引
数であるのに対して、この -3 のことを<strong>実引数</strong>と呼びます。</p>
<p>ちなみに、絶対値というのは数学に出てくる概念で、原点 (この場合は 0 と
考えます) からの距離を表す数値のことです。-3 も +3 も、0 を原点とした場合
には、それぞれ 0 の位置から 3 離れた距離にある数字ということになります。</p>
<p>複数の引数を取る関数も定義することができます。複数の引数は、カンマ ','
で区切って指定します。</p>
<pre>
def sum(x, y)
  return x + y      # 関数を終了し、x + y を戻り値とする。
end

p sum(2, 3)         # =&gt; 5
</pre>
<p>これは引数として与えられたふたつの数値の和を返す関数です。もちろん
実際には 2 + 3 と書いたほうが早くてわかりやすいですから、通常このような
単純な関数を定義することはありません。あくまでも、文法を説明するための
例題と考えてください。</p>


<h2><a name="default">デフォルト引数</a></h2>
<p>呼び出し時に省略可能な引数のことを<strong>デフォルト引数</strong>と
呼びます。デフォルト引数は、仮引数に代入記号 = を付けることで指定でき
ます。デフォルト引数を設定しておくと、カッコ () 内の実引数の箇所に値が
指定されていない場合、仮引数には自動的にデフォルト引数が代入されること
になります。</p>
<pre>
def dice(n = 6)
  return rand(n) + 1
end

p dice              # p dice(6) と同じ
</pre>
<p>上の例では、引数なしで呼び出したときには 1〜6 の乱数を返しますが、
引数を指定すると、乱数の最大値を変更することができるようになっています。
たとえば、dice(8) として呼び出せば 1〜8 の乱数を返すわけです。</p>
<p>多くの組み込み関数も、このように引数が省略可能になっています。</p>


<h2><a name="redefine">関数の再定義</a></h2>
<p>次のプログラムでは、hello という名前の関数を 2 回定義していま
す。</p>
<pre>
def hello
  return &quot;こんにちは&quot;
end

def hello
  return &quot;こんばんは&quot;
end

p hello         # =&gt; &quot;こんばんは&quot;
</pre>
<p>Ruby では、関数の名前が重複した場合でもエラーにはなりません。
このような場合は後から定義されたほうが優先され、古い定義は消滅する
ことになります。</p>


<h6></h6>

</body>
</html>
